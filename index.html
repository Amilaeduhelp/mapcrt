<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏‡∂ö‡∑ä ‡∂±‡∑í‡∂ª‡∑ä‡∂∏‡∑è‡∂´‡∂∫ ‡∂ö‡∂ª‡∂∏‡∑î</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans Sinhala', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 0.9em;
        }
        
        .map-container {
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .canvas-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .external-label {
            position: absolute;
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
            background: white;
            padding: 3px 8px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .label-top {
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .label-right {
            right: -80px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .label-bottom {
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .label-left {
            left: -80px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        #mapCanvas {
            border: 2px solid #667eea;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: crosshair;
            background: white;
        }
        
        .map-selector {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .map-selector label {
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }
        
        .map-selector select {
            padding: 12px 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Noto Sans Sinhala', Arial, sans-serif;
            background: white;
            cursor: pointer;
            min-width: 250px;
            transition: all 0.3s;
        }
        
        .map-selector select:hover {
            border-color: #764ba2;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }
        
        .map-selector select:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 3px 15px rgba(102, 126, 234, 0.4);
        }
        
        .mode-selector {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            color: #667eea;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Noto Sans Sinhala', Arial, sans-serif;
        }
        
        .mode-btn:hover {
            background: #f0f4ff;
        }
        
        .mode-btn.active {
            background: #667eea;
            color: white;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            font-family: 'Noto Sans Sinhala', Arial, sans-serif;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .items-list {
            margin-top: 20px;
            max-width: 800px;
            width: 100%;
        }
        
        .items-list h3 {
            margin-bottom: 10px;
            color: #333;
            text-align: center;
        }
        
        .item {
            background: #f8f9fa;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-name {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 3px;
        }
        
        .item-type {
            font-size: 0.85em;
            color: #666;
        }
        
        .btn-remove {
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.85em;
            border: none;
            cursor: pointer;
        }
        
        .info-box {
            background: #e7f3ff;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            text-align: center;
            font-size: 0.9em;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .header h1 {
                font-size: 1.2em;
            }
            
            .header p {
                font-size: 0.8em;
            }
            
            .map-container {
                padding: 10px;
            }
            
            .map-selector label {
                font-size: 1em;
            }
            
            .map-selector select {
                min-width: 200px;
                padding: 10px 15px;
                font-size: 0.9em;
            }
            
            .mode-btn {
                padding: 8px 15px;
                font-size: 0.9em;
            }
            
            button {
                padding: 10px 20px;
                font-size: 0.9em;
            }
            
            .external-label {
                font-size: 10px;
                padding: 2px 6px;
            }
            
            .label-left {
                left: -60px;
            }
            
            .label-right {
                right: -60px;
            }
            
            .info-box {
                font-size: 0.85em;
                padding: 10px;
            }
            
            .item-name {
                font-size: 0.95em;
            }
            
            .item-type {
                font-size: 0.8em;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1em;
            }
            
            .map-selector select {
                min-width: 180px;
                font-size: 0.85em;
            }
            
            .mode-selector {
                gap: 5px;
            }
            
            .mode-btn {
                padding: 6px 10px;
                font-size: 0.85em;
            }
            
            .controls {
                gap: 8px;
            }
            
            button {
                padding: 8px 15px;
                font-size: 0.85em;
            }
            
            .external-label {
                font-size: 9px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏‡∂ö‡∑ä ‡∂±‡∑í‡∂ª‡∑ä‡∂∏‡∑è‡∂´‡∂∫ ‡∂ö‡∂ª‡∂∏‡∑î</h1>
            <p>‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏‡∑ö ‡∑É‡∑ä‡∂Æ‡∑è‡∂±, ‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∑ö‡∑Å ‡∑É‡∑Ñ ‡∂ú‡∂Ç‡∂ú‡∑è ‡∑É‡∂Ω‡∂ö‡∑î‡∂´‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</p>
        </div>
        
        <div class="map-container">
            <div class="info-box">
                <strong>‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂± ‡∂Ü‡∂ö‡∑è‡∂ª‡∂∫:</strong> ‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂± ‚Üí ‡∂Ω‡∂ö‡∑î‡∂´‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂Ü‡∂ö‡∑è‡∂ª‡∂∫ ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂± ‚Üí ‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏‡∑ö ‡∂Ö‡∂≥‡∑í‡∂±‡∑ä‡∂±
            </div>
            
            <div class="map-selector">
                <label for="mapSelect">üó∫Ô∏è ‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏ ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±:</label>
                <select id="mapSelect" onchange="loadSelectedMap()">
                    <option value="">-- ‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂± --</option>
                    <option value="sl_ol">‡∑É‡∑è. ‡∂¥‡∑ô‡∑Ö ‡∂Ω‡∂Ç‡∂ö‡∑è</option>
                    <option value="world_ol">‡∑É‡∑è.‡∂¥‡∑ô‡∑Ö ‡∂Ω‡∑ù‡∂ö</option>
                    <option value="sl_al">‡∂ã‡∑É‡∑É‡∑ä ‡∂¥‡∑ô‡∑Ö ‡∂Ω‡∂Ç‡∂ö‡∑è</option>
                    <option value="europe_al">‡∂ã‡∑É‡∑É‡∑ä ‡∂¥‡∑ô‡∑Ö ‡∂∫‡∑î‡∂ª‡∑ù‡∂¥‡∑è</option>
                    <option value="india_al">‡∂ã‡∑É‡∑É‡∑ä ‡∂¥‡∑ô‡∑Ö ‡∂â‡∂±‡∑ä‡∂Ø‡∑í‡∂∫‡∑è</option>
                </select>
            </div>
            
            <div class="mode-selector">
                <button class="mode-btn active" onclick="setMode('point')">üìç ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫‡∂ö‡∑ä</button>
                <button class="mode-btn" onclick="setMode('area')">üó∫Ô∏è ‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∑ö‡∑Å‡∂∫‡∂ö‡∑ä</button>
                <button class="mode-btn" onclick="setMode('river')">„Ä∞Ô∏è ‡∂ú‡∂Ç‡∂ú‡∑è‡∑Ä‡∂ö‡∑ä</button>
            </div>
            
            <div class="canvas-wrapper">
                <div class="external-label label-top" id="labelTop">‚ñ≤ 9.83619</div>
                <div class="external-label label-right" id="labelRight">‚ñ∂ 81.86700</div>
                <div class="external-label label-bottom" id="labelBottom">‚ñº 5.91853</div>
                <div class="external-label label-left" id="labelLeft">‚óÄ 79.69264</div>
                <canvas id="mapCanvas" width="700" height="900"></canvas>
            </div>
            
            <div class="controls">
                <button class="btn-success" onclick="downloadMap()">üì• ‡∂¥‡∑í‡∂±‡∑ä‡∂≠‡∑ñ‡∂ª‡∂∫ Download ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
                <button class="btn-secondary" onclick="clearLast()">‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂Ö‡∂∫‡∑í‡∂≠‡∂∏‡∂∫ ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
                <button class="btn-danger" onclick="clearAll()">‡∑É‡∑í‡∂∫‡∂Ω‡∑ä‡∂Ω ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
            </div>
            
            <div class="items-list" id="itemsListContainer" style="display: none;">
                <h3>‡∂ë‡∂ö‡∑ä ‡∂ö‡∑Ö ‡∂Ö‡∂∫‡∑í‡∂≠‡∂∏</h3>
                <div id="itemsList"></div>
            </div>
        </div>
    </div>
    
    <script>
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        
        // Canvas size setup - responsive
        let canvasWidth = 700;
        let canvasHeight = 900;
        
        function resizeCanvas() {
            const wrapper = document.querySelector('.canvas-wrapper');
            const maxWidth = wrapper.clientWidth;
            
            if (maxWidth < canvasWidth) {
                const scale = maxWidth / canvasWidth;
                canvas.width = canvasWidth;
                canvas.height = canvasHeight;
                canvas.style.width = maxWidth + 'px';
                canvas.style.height = (canvasHeight * scale) + 'px';
            } else {
                canvas.width = canvasWidth;
                canvas.height = canvasHeight;
                canvas.style.width = canvasWidth + 'px';
                canvas.style.height = canvasHeight + 'px';
            }
            
            drawMap();
        }
        
        window.addEventListener('resize', resizeCanvas);
        
        // ‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏‡∑ä configurations
        const mapConfigs = {
            sl_ol: {
                name: '‡∑É‡∑è. ‡∂¥‡∑ô‡∑Ö ‡∂Ω‡∂Ç‡∂ö‡∑è',
                url: 'https://raw.githubusercontent.com/Amilaeduhelp/-2025/main/slditalmap-02.jpg',
                bounds: {
                    north: 9.83619,
                    south: 5.91853,
                    east: 81.86700,
                    west: 79.69264
                }
            },
            world_ol: {
                name: '‡∑É‡∑è.‡∂¥‡∑ô‡∑Ö ‡∂Ω‡∑ù‡∂ö',
                url: '',
                bounds: {
                    north: 90,
                    south: -90,
                    east: 180,
                    west: -180
                }
            },
            sl_al: {
                name: '‡∂ã‡∑É‡∑É‡∑ä ‡∂¥‡∑ô‡∑Ö ‡∂Ω‡∂Ç‡∂ö‡∑è',
                url: '',
                bounds: {
                    north: 9.83619,
                    south: 5.91853,
                    east: 81.86700,
                    west: 79.69264
                }
            },
            europe_al: {
                name: '‡∂ã‡∑É‡∑É‡∑ä ‡∂¥‡∑ô‡∑Ö ‡∂∫‡∑î‡∂ª‡∑ù‡∂¥‡∑è',
                url: '',
                bounds: {
                    north: 71,
                    south: 36,
                    east: 40,
                    west: -10
                }
            },
            india_al: {
                name: '‡∂ã‡∑É‡∑É‡∑ä ‡∂¥‡∑ô‡∑Ö ‡∂â‡∂±‡∑ä‡∂Ø‡∑í‡∂∫‡∑è',
                url: '',
                bounds: {
                    north: 35,
                    south: 8,
                    east: 97,
                    west: 68
                }
            }
        };
        
        let bounds = mapConfigs.sl_ol.bounds;
        let items = [];
        let mapImage = new Image();
        let mapLoaded = false;
        let currentMapKey = '';
        let currentMode = 'point'; // 'point', 'area', 'river'
        let isDrawing = false;
        let currentPath = [];
        
        mapImage.onload = function() {
            mapLoaded = true;
            drawMap();
        };
        
        mapImage.onerror = function() {
            console.log('‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏ load ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∂Ö‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í');
            alert('‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏ load ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ‡∂Ö‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í. ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.');
            mapLoaded = false;
            drawMap();
        };
        
        function loadSelectedMap() {
            const select = document.getElementById('mapSelect');
            const mapKey = select.value;
            
            if (!mapKey) {
                return;
            }
            
            const config = mapConfigs[mapKey];
            
            if (!config.url) {
                alert('‡∂∏‡∑ô‡∂∏ ‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏ ‡∂≠‡∑Ä‡∂∏‡∂≠‡∑ä ‡∂ë‡∂ö‡∑ä ‡∂ö‡∂ª ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠. ‡∂â‡∂ö‡∑ä‡∂∏‡∂±‡∑í‡∂±‡∑ä ‡∂Ω‡∂∂‡∑è ‡∂ú‡∂≠ ‡∑Ñ‡∑ê‡∂ö.');
                select.value = currentMapKey;
                return;
            }
            
            currentMapKey = mapKey;
            bounds = config.bounds;
            items = [];
            mapLoaded = false;
            
            mapImage.crossOrigin = "anonymous";
            mapImage.src = config.url;
            
            updateItemsList();
        }
        
        function setMode(mode) {
            currentMode = mode;
            const buttons = document.querySelectorAll('.mode-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Canvas cursor ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
            if (mode === 'point') {
                canvas.style.cursor = 'crosshair';
            } else {
                canvas.style.cursor = 'pointer';
            }
        }
        
        // Mouse events
        canvas.addEventListener('mousedown', handleStart);
        canvas.addEventListener('mousemove', handleMove);
        canvas.addEventListener('mouseup', handleEnd);
        
        // Touch events for mobile
        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });
        
        canvas.addEventListener('touchmove', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });
        
        canvas.addEventListener('touchend', function(e) {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            canvas.dispatchEvent(mouseEvent);
        });
        
        function handleStart(e) {
            if (!mapLoaded) {
                alert('‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂∏‡∑î‡∂Ω‡∑í‡∂±‡∑ä‡∂∏ ‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±!');
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const lng = bounds.west + (x / canvas.width) * (bounds.east - bounds.west);
            const lat = bounds.north - (y / canvas.height) * (bounds.north - bounds.south);
            
            if (currentMode === 'point') {
                // ‡∂≠‡∂±‡∑í ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫‡∂ö‡∑ä
                const name = prompt('‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫‡∑ö ‡∂±‡∂∏ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:', '');
                if (name !== null && name.trim() !== '') {
                    items.push({
                        type: 'point',
                        lat: lat,
                        lng: lng,
                        name: name.trim()
                    });
                    drawMap();
                    updateItemsList();
                }
            } else {
                // ‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∑ö‡∑Å‡∂∫‡∂ö‡∑ä ‡∑Ñ‡∑ù ‡∂ú‡∂Ç‡∂ú‡∑è‡∑Ä‡∂ö‡∑ä - drawing ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                isDrawing = true;
                currentPath = [{x: x, y: y, lat: lat, lng: lng}];
            }
        }
        
        function handleMove(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const lng = bounds.west + (x / canvas.width) * (bounds.east - bounds.west);
            const lat = bounds.north - (y / canvas.height) * (bounds.north - bounds.south);
            
            currentPath.push({x: x, y: y, lat: lat, lng: lng});
            drawMap();
            drawTemporaryPath();
        }
        
        function handleEnd(e) {
            if (!isDrawing) return;
            
            isDrawing = false;
            
            if (currentPath.length < 2) {
                currentPath = [];
                return;
            }
            
            // ‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∑ö‡∑Å‡∂∫‡∂ö‡∑ä ‡∂±‡∂∏‡∑ä, closed shape ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ø ‡∂∫‡∂±‡∑ä‡∂± ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
            if (currentMode === 'area') {
                const firstPoint = currentPath[0];
                const lastPoint = currentPath[currentPath.length - 1];
                const distance = Math.sqrt(
                    Math.pow(lastPoint.x - firstPoint.x, 2) + 
                    Math.pow(lastPoint.y - firstPoint.y, 2)
                );
                
                // ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑‡∂∫‡∂ß 20 pixels ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠ ‡∂±‡∂∏‡∑ä close ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                if (distance < 20) {
                    currentPath.push(firstPoint); // Close the shape
                    
                    const name = prompt('‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∑ö‡∑Å‡∂∫‡∑ö ‡∂±‡∂∏ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:', '');
                    if (name !== null && name.trim() !== '') {
                        items.push({
                            type: 'area',
                            path: currentPath.slice(),
                            name: name.trim()
                        });
                        drawMap();
                        updateItemsList();
                    }
                } else {
                    alert('‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∑ö‡∑Å‡∂∫ ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫‡∂ß ‡∂Ü‡∑É‡∂±‡∑ä‡∂±‡∑Ä click ‡∂ö‡∂ª‡∂±‡∑ä‡∂±!');
                }
            } else if (currentMode === 'river') {
                // ‡∂ú‡∂Ç‡∂ú‡∑è‡∑Ä‡∂ö‡∑ä - open path
                const name = prompt('‡∂ú‡∂Ç‡∂ú‡∑è‡∑Ä‡∑ö ‡∂±‡∂∏ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:', '');
                if (name !== null && name.trim() !== '') {
                    items.push({
                        type: 'river',
                        path: currentPath.slice(),
                        name: name.trim()
                    });
                    drawMap();
                    updateItemsList();
                }
            }
            
            currentPath = [];
        }
        
        function drawTemporaryPath() {
            if (currentPath.length < 2) return;
            
            ctx.beginPath();
            ctx.moveTo(currentPath[0].x, currentPath[0].y);
            
            for (let i = 1; i < currentPath.length; i++) {
                ctx.lineTo(currentPath[i].x, currentPath[i].y);
            }
            
            if (currentMode === 'area') {
                ctx.strokeStyle = 'rgba(128, 128, 128, 0.8)';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫ ‡∑Ñ‡∂≥‡∑î‡∂±‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏‡∂ß ‡∑Ä‡∂ß‡∂∫ ‡∂Ö‡∂≥‡∑í‡∂±‡∑ä‡∂±
                ctx.fillStyle = 'rgba(102, 126, 234, 0.5)';
                ctx.beginPath();
                ctx.arc(currentPath[0].x, currentPath[0].y, 5, 0, Math.PI * 2);
                ctx.fill();
            } else if (currentMode === 'river') {
                ctx.strokeStyle = 'rgba(128, 128, 128, 0.6)';
                ctx.lineWidth = 6;
                ctx.stroke();
            }
        }
        
        function drawMap() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (mapLoaded && mapImage.complete) {
                ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height);
            }
            
            // ‡∑É‡∑í‡∂∫‡∂Ω‡∑î items ‡∂Ö‡∂≥‡∑í‡∂±‡∑ä‡∂±
            items.forEach(item => {
                if (item.type === 'point') {
                    const x = lngToX(item.lng);
                    const y = latToY(item.lat);
                    
                    // ‡∑É‡∑î‡∂Ø‡∑î outline
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ‡∂ö‡∑Ö‡∑î ‡∂≠‡∑í‡∂≠
                    ctx.fillStyle = '#000000';
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ‡∂±‡∂∏
                    if (item.name) {
                        ctx.fillStyle = '#000';
                        ctx.strokeStyle = 'white';
                        ctx.lineWidth = 3;
                        ctx.font = 'bold 12px Noto Sans Sinhala, Arial';
                        ctx.strokeText(item.name, x + 6, y - 6);
                        ctx.fillText(item.name, x + 6, y - 6);
                    }
                } else if (item.type === 'area') {
                    // ‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∑ö‡∑Å‡∂∫ ‡∂Ö‡∂≥‡∑í‡∂±‡∑ä‡∂±
                    ctx.beginPath();
                    ctx.moveTo(item.path[0].x, item.path[0].y);
                    for (let i = 1; i < item.path.length; i++) {
                        ctx.lineTo(item.path[i].x, item.path[i].y);
                    }
                    ctx.closePath();
                    
                    // Fill - ‡∑Ö‡∑è ‡∂Ö‡∂Ω‡∑î ‡∂¥‡∑ê‡∑Ñ‡∑ê‡∂∫
                    ctx.fillStyle = 'rgba(128, 128, 128, 0.3)';
                    ctx.fill();
                    
                    // Outline
                    ctx.strokeStyle = 'rgba(80, 80, 80, 0.7)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    // ‡∂±‡∂∏ (center point ‡∂ë‡∂ö‡∑ö)
                    if (item.name) {
                        const centerX = item.path.reduce((sum, p) => sum + p.x, 0) / item.path.length;
                        const centerY = item.path.reduce((sum, p) => sum + p.y, 0) / item.path.length;
                        
                        ctx.fillStyle = '#000';
                        ctx.strokeStyle = 'white';
                        ctx.lineWidth = 3;
                        ctx.font = 'bold 14px Noto Sans Sinhala, Arial';
                        ctx.textAlign = 'center';
                        ctx.strokeText(item.name, centerX, centerY);
                        ctx.fillText(item.name, centerX, centerY);
                        ctx.textAlign = 'left';
                    }
                } else if (item.type === 'river') {
                    // ‡∂ú‡∂Ç‡∂ú‡∑è‡∑Ä ‡∂Ö‡∂≥‡∑í‡∂±‡∑ä‡∂±
                    ctx.beginPath();
                    ctx.moveTo(item.path[0].x, item.path[0].y);
                    for (let i = 1; i < item.path.length; i++) {
                        ctx.lineTo(item.path[i].x, item.path[i].y);
                    }
                    
                    // ‡∑Ä‡∑í‡∂±‡∑í‡∑Ä‡∑í‡∂Ø ‡∂¥‡∑ô‡∂±‡∑ô‡∂± ‡∂Ö‡∂Ω‡∑î line (‡∂∏‡∑Ñ‡∂≠‡∑ä ‡∂ö‡∑Ö)
                    ctx.strokeStyle = 'rgba(100, 100, 100, 0.5)';
                    ctx.lineWidth = 6;
                    ctx.stroke();
                    
                    // ‡∂±‡∂∏ (path ‡∂ë‡∂ö‡∑ö ‡∂∏‡∑ê‡∂Ø)
                    if (item.name) {
                        const midIndex = Math.floor(item.path.length / 2);
                        const midPoint = item.path[midIndex];
                        
                        ctx.fillStyle = '#000';
                        ctx.strokeStyle = 'white';
                        ctx.lineWidth = 3;
                        ctx.font = 'italic bold 12px Noto Sans Sinhala, Arial';
                        ctx.strokeText(item.name, midPoint.x + 6, midPoint.y - 6);
                        ctx.fillText(item.name, midPoint.x + 6, midPoint.y - 6);
                    }
                }
            });
            
            updateExternalLabels();
        }
        
        function updateExternalLabels() {
            document.getElementById('labelTop').textContent = '‚ñ≤ ' + bounds.north;
            document.getElementById('labelRight').textContent = '‚ñ∂ ' + bounds.east;
            document.getElementById('labelBottom').textContent = '‚ñº ' + bounds.south;
            document.getElementById('labelLeft').textContent = '‚óÄ ' + bounds.west;
        }
        
        function latToY(lat) {
            return canvas.height - ((lat - bounds.south) / (bounds.north - bounds.south)) * canvas.height;
        }
        
        function lngToX(lng) {
            return ((lng - bounds.west) / (bounds.east - bounds.west)) * canvas.width;
        }
        
        function updateItemsList() {
            const listContainer = document.getElementById('itemsListContainer');
            const list = document.getElementById('itemsList');
            
            if (items.length > 0) {
                listContainer.style.display = 'block';
                list.innerHTML = '';
                
                items.forEach((item, index) => {
                    const typeText = item.type === 'point' ? 'üìç ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫' : 
                                   item.type === 'area' ? 'üó∫Ô∏è ‡∂¥‡∑ä‚Äç‡∂ª‡∂Ø‡∑ö‡∑Å‡∂∫' : 
                                   '„Ä∞Ô∏è ‡∂ú‡∂Ç‡∂ú‡∑è‡∑Ä';
                    
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerHTML = `
                        <div class="item-info">
                            <div class="item-name">${item.name}</div>
                            <div class="item-type">${typeText}</div>
                        </div>
                        <button class="btn-remove" onclick="removeItem(${index})">‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
                    `;
                    list.appendChild(div);
                });
            } else {
                listContainer.style.display = 'none';
            }
        }
        
        function removeItem(index) {
            items.splice(index, 1);
            drawMap();
            updateItemsList();
        }
        
        function clearLast() {
            if (items.length > 0) {
                items.pop();
                drawMap();
                updateItemsList();
            }
        }
        
        function clearAll() {
            if (items.length > 0 && confirm('‡∂î‡∂∂‡∂ß ‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∂Ö‡∂∫‡∑í‡∂≠‡∂∏ ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫‡∂Ø?')) {
                items = [];
                drawMap();
                updateItemsList();
            }
        }
        
        function downloadMap() {
            if (!mapLoaded) {
                alert('‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂∏‡∑î‡∂Ω‡∑í‡∂±‡∑ä‡∂∏ ‡∑É‡∑í‡∂≠‡∑í‡∂∫‡∂∏‡∂ö‡∑ä ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂±!');
                return;
            }
            const link = document.createElement('a');
            link.download = 'map_' + new Date().getTime() + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        // Initialize
        resizeCanvas();
        drawMap();
    </script>
</body>
</html>
